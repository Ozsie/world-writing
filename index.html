<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Världsskrivande — Index</title>
    <meta name="description" content="Landing page linking to assignments, flow writing, and world building pages." />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="page-index">
    <header>
      <h1 class="title">Världsskrivande</h1>
    </header>

    <div class="container">
      <div class="toolbar">
        <div class="filters" id="filters" aria-label="Filters"></div>
        <button class="pill" id="refreshBtn" title="Re-scan folders">↻ Refresh</button>
      </div>
      <div class="grid" id="grid" aria-live="polite"></div>
    </div>

    <footer>
      <small>Copyright © 2026 Oscar Djupfeldt</small>
    </footer>
    <script src="pages.js"></script>
    <script>
      // Configuration: the root-level folders to scan
      const FOLDERS = ["assignment", "flow-writing", "world-building"];

      // PAGES is loaded from pages.js

      const state = { activeFilter: "all", items: [] };

      const grid = document.getElementById("grid");
      const filtersEl = document.getElementById("filters");
      const refreshBtn = document.getElementById("refreshBtn");

      function extTitleize(fileName) {
        const base = fileName.replace(/\.[^/.]+$/, "");
        return base.replace(/[\-_]+/g, " ").replace(/\b\w/g, c => c.toUpperCase());
      }

      function render() {
        const items = state.items.filter(it => state.activeFilter === "all" || it.folder === state.activeFilter);
        grid.innerHTML = items.map(it => `
          <div class="card">
            <span class="badge">${it.folder}</span>
            <a href="${it.path}" aria-label="Open ${it.title}"><strong>${it.title}</strong></a>
            <div class="path">${it.path}</div>
          </div>
        `).join("");
      }

      function renderFilters() {
        const set = new Set(["all", ...FOLDERS]);
        filtersEl.innerHTML = "";
        for (const key of set) {
          const btn = document.createElement("button");
          btn.className = "pill";
          btn.textContent = key;
          btn.setAttribute("aria-pressed", String(key === state.activeFilter));
          btn.addEventListener("click", () => {
            state.activeFilter = key;
            for (const b of filtersEl.querySelectorAll(".pill")) b.setAttribute("aria-pressed", String(b === btn));
            render();
          });
          filtersEl.appendChild(btn);
        }
      }

      async function discover() {
        const all = [];

        // Include fallback only for those not already found
        for (const fb of PAGES) {
          if (!all.some(it => it.path === fb.path)) {
            const folder = fb.path.split("/")[0];
            all.push({ folder, path: fb.path, title: fb.title || extTitleize(fb.path.split("/").pop() || fb.path) });
          }
        }

        // Sort by folder then title
        all.sort((a, b) => a.folder.localeCompare(b.folder) || a.title.localeCompare(b.title));

        state.items = all;
        renderFilters();
        render();
      }

      refreshBtn.addEventListener('click', discover);
      discover();
    </script>
  </body>
  </html>
